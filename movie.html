<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movies</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');

        * {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
        }

        main {
            overflow-x: hidden;
        }

        a,
        a.visited {
            text-decoration: none;
            color: #393939;
        }

        div> ::-webkit-scrollbar {
            width: 0;
        }

        /* Background Color */

        .bg-yellow {
            background-color: #E7C160;
        }

        .bg-lightgray {
            background-color: #E1E1E1;
        }

        .bg-darkgray {
            background-color: #393939;
        }

        .bg-middlegray {
            background-color: #5d5d5d;
        }

        /* Movie Details */

        #poster {
            box-shadow: 0rem 0.25rem 0.5rem -0.125rem #393939;
        }

        #cast {
            overflow-x: scroll;
        }

        .cast {
            background-color: #FFFFFF;
            position: relative;
            box-shadow: 0rem 0.25rem 0.5rem -0.125rem #393939;
            border-radius: 1.5rem 1.5rem 0rem 0rem;
            min-width: 11.5625rem;
            margin-right: 1rem;
            margin-left: 1rem;
        }

        .cast-img {
            background-color: #5d5d5d;
            background-repeat: no-repeat;
            background-size: cover;
            border-radius: 1.5rem 1.5rem 0rem 0rem;
            height: 13.5625rem;
        }

        /* Multimedia */

        #media-flex {
			display: flex;
			flex-wrap: wrap;
			justify-content: center;
			align-items: center;
			margin: auto;
			background-color: #FFFFFF;
			box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
			overflow: hidden;
			flex-direction: column;
			position: relative;
            width: 100%;
			min-height: 400px;
			height: 110vh;
			max-width: 1000px;
		}

        #left-zone {
            background-color: #E7C160;
            display: flex;
            flex: 0 0 auto;
			height: 100%;
			width: 100%;
            max-width: 12rem;
		}

		#left-zone .media-list {
			display: flex;
			list-style: none;
			align-content: stretch;
			flex-direction: column;
			flex: 1 1 auto;
			margin: auto;
			padding: 0;
			box-sizing: border-box;
		}

		.media-tab input {
			display: none;
		}

		label {
			display: block;
			opacity: 0.5;
			height: 50px;
			text-align: center;
			line-height: 50px;
			position: relative;
		}

		label:hover {
			opacity: 0.75;
			cursor: pointer;
		}

		.media-content {
			position: absolute;
			right: 0;
			bottom: 0;
			opacity: 0;
			transform: translateY(100%);
			height: 50%;
			width: 100%;
			transition: 0.5s ease-out;
			display: flex;
			align-items: center;
			justify-content: center;
			flex-direction: column;
			pointer-events: none;
		}

		.media-content p {
			max-width: 50%;
			text-align: center;
		}

		#right-zone {
            flex: 1 0 auto;
            height: 50%;
			width: 100%;
		}

		input:checked~.media-content {
			transform: translateY(0%);
			-webkit-transition: -webkit-transform 1s;
			transition: -webkit-transform 1s;
			-o-transition: transform 1s;
			transition: transform 1s;
			transition: transform 1s, -webkit-transform 1s;
			opacity: 1;
		}

		input:checked~label {
			opacity: 1;
            font-weight: bold;
			animation: all 1s cubic-bezier(0.455, 0.03, 0.515, 0.955);
		}

		input:checked~label.media-label {
			border-right: solid 4px #5d5d5d;
		}

		.media-label:hover {
			font-size: 1.2rem;
            background-image: linear-gradient(to right, #FFFFFF, #E7C160);
			transition: font-size 0.5s;
		}

        /* Movie Reviews */

        #ratings-count {
            font-size: 1.25rem;
        }

        #star-container {
            background-color: #393939;
            clip-path: url(#starClip);
            height: 2.5rem;
            width: 25rem;
        }

        #star-main {
            background-color: #E7C160;
            height: 2.5rem;
        }

        .bar-container {
            background-color: #FFFFFF;
            border-radius: 1rem;
            height: 0.8rem;
            width: 90%;
        }

        .bar {
            background-color: #E7C160;
            border-radius: 1rem;
            height: 0.8rem;
        }

        #reveiws {
            overflow-x: scroll;
        }

        .reveiws {
            background-color: #FFFFFF;
            overflow-y: hidden;
            position: relative;
            box-shadow: 0rem 0.25rem 0.5rem -0.125rem #393939;
            height: 30.9375rem;
            width: 20.625rem;
            margin-right: 1rem;
            margin-left: 1rem;
        }

        .avatar {
            clip-path: circle();
            max-height: 4.5rem;
        }

        .reveiwer-container {
            background-color: #393939;
            clip-path: url(#starClip);
            height: 1.25rem;
            width: 12.5rem;
        }

        .reveiwer-rating {
            background-color: #E7C160;
            height: 1.25rem;
        }

        .review-content {
            overflow-wrap: break-word;
        }

        /* Media Queries */
        @media screen and (min-width: 992px) and (max-width: 1200px) {
            #star-container {
                height: 2rem;
                width: 20rem;
            }
        }

        @media (min-width: 480px) {
			#media-flex {
				-webkit-box-orient: horizontal;
				-webkit-box-direction: normal;
				-ms-flex-direction: row;
				flex-direction: row;
				min-height: auto;
				height: 400px;
				/* position: absolute; */
				top: 0;
				bottom: 0;
				left: 0;
				right: 0;
			}

			#left-zone .media-list {
				border-right: 2px solid #cccccc;
			}

			.media-content {
				width: 65%;
				height: 100%;
				pointer-events: auto;
				-webkit-transform: translateY(-100%);
				-ms-transform: translateY(-100%);
				transform: translateY(-100%);
			}

			#left-zone {
				width: 35%;
			}

			#right-zone {
				height: 100%;
				width: 65%;
			}
		}
    </style>
</head>

<body>
    <!-- Navbar -->
    <main>
        <!-- Movie Details -->
        <section class="bg-lightgray row justify-content-center p-3">
            <div class="col-lg-5 text-center mb-3" id="movie-poster">
            </div>
            <div class="col-lg-7 d-flex flex-column justify-content-evenly">
                <div>
                    <h3 class="fw-bold" id="title"></h3>
                    <h6 id="genres"></h6>
                </div>
                <div>
                    <hr>
                    <h6 class="fw-bold">Synopsis</h6>
                </div>
                <p id="synopsis"></p>
                <div>
                    <hr>
                    <h6 class="fw-bold">Cast</h6>
                </div>
                <div class="d-flex" id="cast"></div>
            </div>
        </section>
        <!-- Multimedia -->
        <section class="bg-darkgray py-5 px-3">
            <div class="rounded" id="media-flex">
                <div id="left-zone">
                    <ul class="media-list">
                        <li class="media-tab">
                            <input type="radio" id="radio-media-0" name="media-group" checked="checked" />
                            <label class="media-label" id="media-label-0" for="radio-media-0">Trailer</label>
                            <div class="media-content" id="media-content-0">
                            </div>
                        </li>
                        <li class="media-tab">
                            <input type="radio" id="radio-media-1" name="media-group"/>
                            <label class="media-label" id="media-label-1" for="radio-media-1">Videos</label>
                            <div class="media-content" id="media-content-1">
                            </div>
                        </li>
                        <li class="media-tab">
                            <input type="radio" id="radio-media-2" name="media-group"/>
                            <label class="media-label" id="media-label-2" for="radio-media-2">Backdrops</label>
                            <div class="media-content" id="media-content-2">
                            </div>
                        </li>
                        <li class="media-tab">
                            <input type="radio" id="radio-media-3" name="media-group"/>
                            <label class="media-label" id="media-label-3" for="radio-media-3">Posters</label>
                            <div class="media-content" id="media-content-3">
                            </div>
                        </li>
                    </ul>
                </div>
                <div id="right-zone"></div>
            </div>
        </section>
        <!-- Review Area -->
        <div class="bg-yellow px-5 py-3">
            <h4 class="my-auto">Ratings & Reviews
                <i class="fa fa-arrow-right"></i>
            </h4>
        </div>
        <section class="bg-lightgray">
            <svg width="0" height="0">
                <defs>
                    <clipPath id="starClip" clipPathUnits="objectBoundingBox">
                        <path
                            d="M0.05,0 L0.062,0.382 H0.098 L0.068,0.618 L0.08,1 L0.05,0.764 L0.021,1 L0.032,0.618 L0.002,0.382 H0.039 L0.05,0 M0.151,0 L0.162,0.382 H0.199 L0.169,0.618 L0.18,1 L0.151,0.764 L0.121,1 L0.132,0.618 L0.103,0.382 H0.139 L0.151,0 M0.251,0 L0.263,0.382 H0.299 L0.269,0.618 L0.281,1 L0.251,0.764 L0.222,1 L0.233,0.618 L0.203,0.382 H0.24 L0.251,0 M0.352,0 L0.363,0.382 H0.4 L0.37,0.618 L0.381,1 L0.352,0.764 L0.322,1 L0.333,0.618 L0.304,0.382 H0.34 L0.352,0 M0.452,0 L0.463,0.382 H0.5 L0.47,0.618 L0.482,1 L0.452,0.764 L0.423,1 L0.434,0.618 L0.404,0.382 H0.441 L0.452,0 M0.553,0 L0.564,0.382 H0.6 L0.571,0.618 L0.582,1 L0.553,0.764 L0.523,1 L0.534,0.618 L0.505,0.382 H0.541 L0.553,0 M0.653,0 L0.664,0.382 H0.701 L0.671,0.618 L0.683,1 L0.653,0.764 L0.624,1 L0.635,0.618 L0.605,0.382 H0.642 L0.653,0 M0.754,0 L0.765,0.382 H0.801 L0.772,0.618 L0.783,1 L0.754,0.764 L0.724,1 L0.735,0.618 L0.706,0.382 H0.742 L0.754,0 M0.854,0 L0.865,0.382 H0.902 L0.872,0.618 L0.884,1 L0.854,0.764 L0.825,1 L0.836,0.618 L0.806,0.382 H0.843 L0.854,0 M0.955,0 L0.966,0.382 H1 L0.973,0.618 L0.984,1 L0.955,0.764 L0.925,1 L0.936,0.618 L0.907,0.382 H0.943 L0.955,0" />
                    </clipPath>
                </defs>
            </svg>
            <div class="row justify-content-around px-3 mt-3">
                <div class="col-lg-4 text-center">
                    <div class="d-flex justify-content-center align-items-center">
                        <h1 id="ratings-avg" class="pe-2"></h1>
                        <div id="ratings-count">
                            - <span id="ratings-num"></span> Ratings
                        </div>
                    </div>
                    <div class="mx-auto mb-3" id="star-container">
                        <div id="star-main"></div>
                    </div>
                </div>
                <div class="row col-lg-8">
                    <div class="col-sm-6" id="ratings-1"></div>
                    <div class="col-sm-6" id="ratings-2"></div>
                </div>
                <div class="col-lg-12 d-flex my-5" id="reveiws">
                </div>
            </div>
        </section>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
        crossorigin="anonymous"></script>
    <script>

        const urlParams = new URLSearchParams(window.location.search);
        const movieId = urlParams.get('id');

        // Poster Display

        // Ratings Display
        function displayRatings(i) {
            for (let x = 10; x > 0; x--) {
                (x > 5) ? i = 1 : i = 2;
                document.querySelector(`#ratings-${i}`).innerHTML += `
                    <div class="d-flex">
                        <h5 class="m-auto">${x}</h5>
                        <div class="bar-container m-auto">
                            <div class="bar w-0" id="bar-${x - 1}"></div>
                        </div>
                    </div>
                `;
            }
        }

        displayRatings(0);

        // Ratings Breakdown
        function ratingsBreakdown(count, avg, initial) {
            const arr = [];
            let votes = count;
            let total = Math.round(count * avg);

            initial.forEach((num) => {
                arr.push(num);
                total -= num;
                votes--;
            })

            for (let y = 0; y < count; y++) {
                let x = Math.floor((Math.random() * 10) + 1);
                for (let z = 10; z > 0; z--) {
                    if ((total / x) < votes && x > 0) {
                        x--;
                    } else if ((total % x) !== 0 && x < 10) {
                        x++;
                    }
                }
                votes--;
                total -= x;
                arr.push(x);
            }

            for (let i = 9; i >= 0; i--) {
                const movieRating = document.querySelector(`#bar-${i}`);
                let counter = 0;
                arr.forEach((num) => {
                    if (num == (i + 1)) {
                        counter++;
                    }
                });
                width = 100 * (counter / count);
                movieRating.style.width = `${width.toFixed(3)}%`;
            }
        }

        // Get Ratings
        function getRatings(item) {
            return item.author_details.rating;
        }

        // Cast Display
        function addCast(item) {
            const castArea = document.querySelector('#cast');
            castArea.innerHTML += `
                <div class="cast">
                    <div class="cast-img" style="background-image:url('https://image.tmdb.org/t/p/w185${item.profile_path}')">
                    </div>
                    <div class="cast-role mt-3 mb-1">
                        <a href="#" class="stretched-link text-center">
                            <h6 class="fw-bold">${item.name}</h6>
                            <p><small>${item.character}</small></p>
                        </a>
                    </div>
                </div>
            `;
        }

        // Reviews Display
        function addReviews(item, index) {
            const reviewArea = document.querySelector('#reveiws');
            const avatar = item.author_details.avatar_path;
            const reviewRating = item.author_details.rating;
            if (avatar !== null) {
                result = (avatar.slice(1, 6) !== 'https') ?
                    `https://image.tmdb.org/t/p/w92/${avatar}` :
                    avatar.slice(1);
            } else { result = '' }
            reviewArea.innerHTML += `
                <div class="reveiws col-3 p-3 rounded">
                    <div class="d-flex">
                        <div>
                            <img class="avatar img-fluid" src="${result}">
                        </div>
                        <div class="flex-fill ${avatar !== null ? 'ms-2' : 'me-5'} mt-1">
                            <h5>${item.author}</h5>
                            <div class="reveiwer-container">
                                <div class="reveiwer-rating" id="reveiwer-rating-${index}"></div>
                            </div>
                        </div>
                    </div>
                    <div class="review-content mx-3 mt-3">
                        ${item.content}
                    </div>
                </div>
            `;
            const reviewScore = document.querySelector(`#reveiwer-rating-${index}`);
            reviewScore.style.width = `${reviewRating}0%`;
        }

        // API
        const options = {
            method: 'GET',
            headers: {
                accept: 'application/json',
                Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIyMzJjNGZlZWViNzFhY2FiMDc4M2QyYTVhNzNjZGQ3NiIsInN1YiI6IjY0NjFmZDc2YTY3MjU0MDE2NGRlYzc3YiIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.BV3-59m-NcEVwdz_snr_om5eyrwF2zgIdmkHo-Wd7Ls'
            }
        };

        fetch(`https://api.themoviedb.org/3/movie/${movieId}?append_to_response=videos%2Cimages%2Creviews%2Ccredits&include_image_language=en%2Cnull&language=en-US`, options)
            .then(response => response.json())
            .then(response => {

                // Movie Poster
                const moviePoster = document.querySelector('#movie-poster');
                moviePoster.innerHTML = `
                    <img class="img-fluid rounded" id="poster" src="https://image.tmdb.org/t/p/w500${response.poster_path}">
                `;

                // Movie Details
                const movieTitle = document.querySelector('#title');
                const movieGenres = document.querySelector('#genres');
                const movieSynopsis = document.querySelector('#synopsis');

                movieTitle.innerHTML = response.title;

                for (let x = 0; x < response.genres.length; x++) {
                    x !== response.genres.length - 1 ?
                        movieGenres.innerHTML += `${response.genres[x].name}, ` :
                        movieGenres.innerHTML += response.genres[x].name;
                };

                movieSynopsis.innerHTML = response.overview;

                // Cast
                const cast = response.credits.cast;
                cast.forEach(addCast);

                // Multimedia

                const backdrops = response.images.backdrops;
                const posters = response.images.posters;

                const videos = response.videos.results;
                const trailers = videos.filter(vid => vid.type == "Trailer");
                const otherVideos = videos.filter(vid => vid.type !== "Trailer");

                // Ratings
                const reviews = response.reviews.results;
                const ratingsCount = response.vote_count;
                const ratingsAverage = response.vote_average;

                // Ratings Breakdown
                const reviewRatings = reviews.map(getRatings);
                ratingsBreakdown(ratingsCount, ratingsAverage, reviewRatings);

                // Ratings Main
                const ratingsAvg = document.querySelector('#ratings-avg');
                const ratingsNum = document.querySelector('#ratings-num');
                const starMain = document.querySelector('#star-main');
                starMain.style.width = `${ratingsAverage * 10}%`;
                ratingsAvg.innerHTML = ratingsAverage.toFixed(1);
                ratingsNum.innerHTML = ratingsCount;

                // Reviews
                reviews.forEach(addReviews);

                console.log(response);
            })
            .catch(err => console.error(err));

    </script>
</body>

</html>