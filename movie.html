<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movies</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');

        * {
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
        }

        #nav-bar {
            background-color: #393939;
            color: #FFFFFF;
        }

        #search-bar,
        .bg-yellow {
            background-color: #E7C160;
        }

        .bg-lightgray {
            background-color: #E1E1E1;
        }

        .bg-darkgray {
            background-color: #393939;
        }

        .input-group-text {
            background-color: #393939;
            color: #FFFFFF;
        }

        .nav-link {
            color: #393939;
        }

        .nav-link:hover {
            color: #393939;
            background-color: #FBF6E7;
        }

        .nav-link.active {
            color: #393939;
            background-color: #FBF6E7;
        }

        .top-nav-links {
            color: #FFFFFF;
        }

        .top-nav-links:visited {
            color: #FFFFFF;
        }

        .top-nav-links:hover {
            background-color: #5d5d5d;
        }

        .top-nav-links:active {
            background-color: #5d5d5d;
        }

        #v-tab {
            background-color: #E7C160;
        }

        #v-tabContent {
            background-color: #FFFFFF;
        }

        main {
            overflow: hidden;
        }

        .star-container {
            clip-path: url(#myClip);
            background-color: #393939;
            height: 2.5rem;
            width: 100%;
        }

        #star-main {
            background-color: #E7C160;
            height: 2.5rem;
        }

        .bar-container {
            background-color: #FFFFFF;
            border-radius: 1rem;
            height: 0.8rem;
            width: 90%;
        }

        .bar {
            background-color: #E7C160;
            border-radius: 1rem;
            height: 0.8rem;
        }

        #ratings-count {
            font-size: 1.25rem;
        }

        .reveiwer-container {
            clip-path: url(#myClip);
            background-color: #393939;
            height: 1.25rem;
            width: 100%;
        }

        .reveiwer-rating {
            background-color: #E7C160;
            height: 1.25rem;
            width: 50%;
        }

        #reveiws {
            overflow-x: scroll;
        }

        div> ::-webkit-scrollbar {
            width: 0;
        }

        .reveiws {
            overflow-y: hidden;
            margin-left: 1rem;
            margin-right: 1rem;
            height: 32rem;
        }

        .avatar {
            clip-path: circle();
            max-height: 4.5rem;
        }

        .review-content {
            overflow-wrap: break-word;
        }

        #star-0 {
            width: 0%;
        }

        #star-0 {
            width: 0%;
        }

        @media screen and (min-width: 576px) and (max-width: 992px) {
            .star-container {
                width: 70%;
            }
        }
    </style>
</head>

<body>
    <main>
        <div>
            <ul class="nav justify-content-center" id="nav-bar">
                <li class="nav-item">
                    <a class="nav-link top-nav-links py-3 px-5" href="#">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link top-nav-links py-3 px-5" href="#">Categories</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link top-nav-links py-3 px-5" href="#">People</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link top-nav-links py-3 px-5" href="#">Calendar</a>
                </li>
            </ul>
            <div class="row align-items-center px-5 py-2" id="search-bar">
                <div class="col-md-2 mx-2">
                    <h1 class="text-center my-auto">MOBEES</h1>
                </div>
                <div class="col-md mx-2 input-group">
                    <span class="input-group-text rounded-start-pill">
                        <i class="fa fa-search"></i>
                    </span>
                    <input class="form-control rounded-end-pill" type="text">
                </div>
            </div>
        </div>
        <div class="row justify-content-center bg-lightgray p-3">
            <div class="col-md-4 text-center mb-3" id="movie-poster">
            </div>
            <div class="col-md-8">
                <div>
                    <h3 id="title"></h3>
                    <h6 id="genres"></h6>
                </div>
                <hr>
                <div>
                    <h6>Synopsis</h6>
                    <p id="synopsis"></p>
                </div>
                <hr>
                <div>
                    <h6>Cast</h6>
                    <div id="cast">

                    </div>
                </div>
            </div>
        </div>
        <div class="d-flex bg-darkgray align-items-start py-5 px-3">

        </div>
        <div class="bg-yellow px-5 py-3">
            <h4 class="my-auto">Ratings & Reviews <i class="fa fa-arrow-right"></i></h4>
        </div>
        <div class="bg-lightgray">
            <svg width="0" height="0">
                <defs>
                    <clipPath id="myClip" clipPathUnits="objectBoundingBox">
                        <path
                            d="M0.05,0 L0.062,0.382 H0.098 L0.068,0.618 L0.08,1 L0.05,0.764 L0.021,1 L0.032,0.618 L0.002,0.382 H0.039 L0.05,0 M0.151,0 L0.162,0.382 H0.199 L0.169,0.618 L0.18,1 L0.151,0.764 L0.121,1 L0.132,0.618 L0.103,0.382 H0.139 L0.151,0 M0.251,0 L0.263,0.382 H0.299 L0.269,0.618 L0.281,1 L0.251,0.764 L0.222,1 L0.233,0.618 L0.203,0.382 H0.24 L0.251,0 M0.352,0 L0.363,0.382 H0.4 L0.37,0.618 L0.381,1 L0.352,0.764 L0.322,1 L0.333,0.618 L0.304,0.382 H0.34 L0.352,0 M0.452,0 L0.463,0.382 H0.5 L0.47,0.618 L0.482,1 L0.452,0.764 L0.423,1 L0.434,0.618 L0.404,0.382 H0.441 L0.452,0 M0.553,0 L0.564,0.382 H0.6 L0.571,0.618 L0.582,1 L0.553,0.764 L0.523,1 L0.534,0.618 L0.505,0.382 H0.541 L0.553,0 M0.653,0 L0.664,0.382 H0.701 L0.671,0.618 L0.683,1 L0.653,0.764 L0.624,1 L0.635,0.618 L0.605,0.382 H0.642 L0.653,0 M0.754,0 L0.765,0.382 H0.801 L0.772,0.618 L0.783,1 L0.754,0.764 L0.724,1 L0.735,0.618 L0.706,0.382 H0.742 L0.754,0 M0.854,0 L0.865,0.382 H0.902 L0.872,0.618 L0.884,1 L0.854,0.764 L0.825,1 L0.836,0.618 L0.806,0.382 H0.843 L0.854,0 M0.955,0 L0.966,0.382 H1 L0.973,0.618 L0.984,1 L0.955,0.764 L0.925,1 L0.936,0.618 L0.907,0.382 H0.943 L0.955,0" />
                    </clipPath>
                </defs>
            </svg>
            <div class="row justify-content-center px-3 mt-3">
                <div class="col-lg-4 text-center">
                    <div class="d-flex justify-content-center align-items-center">
                        <h1 id="ratings-avg" class="pe-2"></h1>
                        <div id="ratings-count">
                            - <span id="ratings-num"></span> Ratings
                        </div>
                    </div>
                    <div class="star-container mb-3 mx-auto">
                        <div id="star-main"></div>
                    </div>
                </div>
                <div class="row col-lg-8">
                    <div class="col-sm-6">
                        <div class="d-flex">
                            <h5 class="m-auto">10</h5>
                            <div class="m-auto bar-container">
                                <div class="bar" id="bar-9"></div>
                            </div>
                        </div>
                        <div class="d-flex">
                            <h5 class="m-auto">9</h5>
                            <div class="m-auto bar-container">
                                <div class="bar" id="bar-8"></div>
                            </div>
                        </div>
                        <div class="d-flex">
                            <h5 class="m-auto">8</h5>
                            <div class="m-auto bar-container">
                                <div class="bar" id="bar-7"></div>
                            </div>
                        </div>
                        <div class="d-flex">
                            <h5 class="m-auto">7</h5>
                            <div class="m-auto bar-container">
                                <div class="bar" id="bar-6"></div>
                            </div>
                        </div>
                        <div class="d-flex">
                            <h5 class="m-auto">6</h5>
                            <div class="m-auto bar-container">
                                <div class="bar" id="bar-5"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="d-flex">
                            <h5 class="m-auto">5</h5>
                            <div class="m-auto bar-container">
                                <div class="bar" id="bar-4"></div>
                            </div>
                        </div>
                        <div class="d-flex">
                            <h5 class="m-auto">4</h5>
                            <div class="m-auto bar-container">
                                <div class="bar" id="bar-3"></div>
                            </div>
                        </div>
                        <div class="d-flex">
                            <h5 class="m-auto">3</h5>
                            <div class="m-auto bar-container">
                                <div class="bar" id="bar-2"></div>
                            </div>
                        </div>
                        <div class="d-flex">
                            <h5 class="m-auto">2</h5>
                            <div class="m-auto bar-container">
                                <div class="bar" id="bar-1"></div>
                            </div>
                        </div>
                        <div class="d-flex">
                            <h5 class="m-auto">1</h5>
                            <div class="m-auto bar-container">
                                <div class="bar" id="bar-0"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="d-flex col-lg-12 flex-nowrap my-5" id="reveiws">
                </div>
            </div>
        </div>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
        crossorigin="anonymous"></script>
    <script>

        const urlParams = new URLSearchParams(window.location.search);
        // const movieId = urlParams.get('id');
        const movieId = '603692'

        // Ratings Breakdown
        function ratingsBreakdown(count, average) {
            const ratingsTotal = Math.round(count * average);
            let rating = ratingsTotal;

            for (let y = 9; y >= 0; y--) {
                const movieRating = document.querySelector(`#bar-${y}`);
                const max = (rating * 0.5);
                const min = (rating * 0.1);
                let random, width;

                if (y !== 0) {
                    random = Math.floor((Math.random() * (max - min)) + min);
                    width = 100 * (random / ratingsTotal);
                } else {
                    width = 100 * (rating / ratingsTotal);
                }

                rating -= random;
                movieRating.style.width = `${width.toFixed(3)}%`;
            }
        }

        function addReviews(item, index) {
            const reviewArea = document.querySelector('#reveiws');
            const avatar = item.author_details.avatar_path;
            const reviewRating = item.author_details.rating;
            if (avatar !== null) {
                result = (avatar.slice(1, 6) !== 'https') ? 
                    `https://image.tmdb.org/t/p/w92/${avatar}` : 
                    avatar.slice(1);
            } else {result = ''}
            reviewArea.innerHTML += `
                <div class="reveiws col-3 p-3 bg-white rounded">
                    <div class="d-flex">
                        <div>
                            <img class="avatar img-fluid" src="${result}">
                        </div>
                        <div class="flex-fill ${avatar !== null ? 'ms-2':'me-5'} mt-1">
                            <h5>${item.author}</h5>
                            <div class="reveiwer-container">
                                <div class="reveiwer-rating" id="reveiwer-rating-${index}"></div>
                            </div>
                        </div>
                    </div>
                    <div class="review-content mx-3 mt-3">
                        ${item.content}
                    </div>
                </div>
            `;
            const reviewScore = document.querySelector(`#reveiwer-rating-${index}`);
            reviewScore.style.width = `${reviewRating}0%`;
        }

        const options = {
            method: 'GET',
            headers: {
                accept: 'application/json',
                Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIyMzJjNGZlZWViNzFhY2FiMDc4M2QyYTVhNzNjZGQ3NiIsInN1YiI6IjY0NjFmZDc2YTY3MjU0MDE2NGRlYzc3YiIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.BV3-59m-NcEVwdz_snr_om5eyrwF2zgIdmkHo-Wd7Ls'
            }
        };

        fetch(`https://api.themoviedb.org/3/movie/${movieId}?append_to_response=videos%2Cimages%2Creviews%2Ccredits&include_image_language=en%2Cnull&language=en-US`, options)
            .then(response => response.json())
            .then(response => {

                const cast = response.credits.cast;



                const backdrops = response.images.backdrops;
                const posters = response.images.posters;

                const videos = response.videos.results;
                const trailers = videos.filter(vid => vid.type == "Trailer");
                const otherVideos = videos.filter(vid => vid.type !== "Trailer");

                // Movie Poster
                const moviePoster = document.querySelector('#movie-poster');
                moviePoster.innerHTML = `
                    <img class="img-fluid rounded" src="https://image.tmdb.org/t/p/w342${response.poster_path}">
                `;

                // Movie Details
                const movieTitle = document.querySelector('#title');
                const movieGenres = document.querySelector('#genres');
                const movieSynopsis = document.querySelector('#synopsis');
                const movieCast = document.querySelector('#cast');

                movieTitle.innerHTML = response.title;

                for (let x = 0; x < response.genres.length; x++) {
                    x !== response.genres.length - 1 ?
                        movieGenres.innerHTML += `${response.genres[x].name}, ` :
                        movieGenres.innerHTML += response.genres[x].name;
                };

                movieSynopsis.innerHTML = response.overview;

                // Ratings
                const ratingsCount = response.vote_count;
                const ratingsAverage = response.vote_average;

                // Ratings Breakdown
                ratingsBreakdown(ratingsCount, ratingsAverage);

                // Ratings Main
                const ratingsAvg = document.querySelector('#ratings-avg');
                const ratingsNum = document.querySelector('#ratings-num');
                const starMain = document.querySelector('#star-main');
                starMain.style.width = `${ratingsAverage * 10}%`;
                ratingsAvg.innerHTML = ratingsAverage.toFixed(1);
                ratingsNum.innerHTML = ratingsCount;

                // Reviews
                const reviews = response.reviews.results;
                reviews.forEach(addReviews);

                console.log(response);

            })
            .catch(err => console.error(err));

    </script>
</body>

</html>